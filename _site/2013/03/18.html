<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="基于 Xendesktop 的虚拟化桌面环境搭建，并在 Windows  Server 2008 R2 上配置 Active Directory 进行虚拟桌面的用户管理。真正的实现云桌面" />
    <meta name="author" content="唐久军">
    
    <link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="/assets/css/blog.css">
    <script type="text/javascript" src="/assets/js/blog.js"></script>

    <title>基于 Xendesktop 和 Active Directory 的虚拟桌面环境搭建</title>

    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-39325120-3']);
        _gaq.push(['_trackPageview']);

        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>

  </head>

  <body>
<div class="nav nav-fix-top">
    <div class="navbar-panel">
        <div class="brand">
            <a href="/" class="light">唐久军的博客</a>
        </div>

        <div class="catalog pull-right">
            <ul>
                <li><a href="/categories.html">分类</a></li>
                <li><a href="/tags.html">标签</a></li>
                <li><a href="/projects.html">项目</a></li>
                <li><a href="/archives.html">归档</a></li>
                <li><a href="/about_me.html">关于我</a></li>
            </ul>
        </div>
    </div>
</div>

<!-- 防止 IE6、7 中定位元素导致相邻元素 margin-top 失效 -->
<div style="height: 0px"></div>
  <div class="well well-header">
      <ul>
          <li  class="badge badge-info badge-large pull-right">
            <a href="/categories.html?#anchor服务器">分类：服务器</a></li>
      </ul>
      <ul>
        
          <li  class="badge badge-inverse pull-right">
              <a href="/tags.html?#anchorXendesktop">Xendesktop</a>
          </li>
        
          <li  class="badge badge-inverse pull-right">
              <a href="/tags.html?#anchorWindows">Windows</a>
          </li>
        
      </ul>

      <a class="time-backgroud"></a>
      <span class="time-meta">2013年03月18日</span>
      <h1>基于 Xendesktop 和 Active Directory 的虚拟桌面环境搭建</h1>
      <hr>
      <p>基于 Xendesktop 的虚拟化桌面环境搭建，并在 Windows  Server 2008 R2 上配置 Active Directory 进行虚拟桌面的用户管理。真正的实现云桌面</p>
  </div>

  <div class="well">
    <h3>整体概述</h3>

<ol>
<li><p>整体过程：</p>

<ul>
<li>在 XenServer 上新建一台 Windows Server 2008 R2 虚拟机, 然后在上面安装 Active Directory，来作为 用户管理。</li>
<li>然后新建一台 Windows Server 2008 R2 虚拟机，在上面安装好 Xendesktop。</li>
<li>最后再新建一台 Windows 7 虚拟机，在上面安装 Xendesktop Agent，作为模板镜像。</li>
<li>把所有计算机加入到同一个域中，然后在 Xendesktop 虚拟机上配置。</li>
</ul></li>
<li><p>安装注意（必读）</p>

<ul>
<li>最先安装 Active Directory 服务器，安装前先配置 IP 为静态，更改计算机主机名，然后才开始安装 AD。</li>
<li>安装 Xendesktop 的计算机最好先改好主机名，配置好静态 IP，然后把它加入到 先前安装的 AD 域中。否则提示无法加载管理单元</li>
<li>安装 Xendesktop 的计算机不能同 安装 AD 的服务器使用同一个模版，否则在部署时会提示当前凭据的权限不足</li>
<li>如果对防火墙，端口不了解的话，安装时最好把防火墙关闭了</li>
</ul></li>
</ol>

<p>下面我们就详细说明整过安装过程</p>

<h3>安装 AD</h3>

<ol>
<li><p>安装前请配置好静态 IP，修改主机名，关闭防火墙，配置好服务器时间，然后重启。</p></li>
<li><p>安装 AD 步骤：</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">打开 &quot;开始&quot; -&gt; &quot;运行&quot; -&gt;　&quot;dcpromo&quot; 等一会，会弹出 Active Directory 域服务安装向导；

选择 &quot;下一步&quot; -&gt; 
选择 &quot;在新林中新建域&quot; 然后 &quot;下一步&quot; -&gt; 
输入新建林的根域名 &quot;ad.test.com&quot; 然后 &quot;下一步&quot; -&gt;  
选择林功能级别 &quot;Windows Server 2003&quot; 然后 &quot;下一步&quot; -&gt; 
勾选 &quot;DNS 服务器&quot; 然后 &quot;下一步&quot; -&gt; 
在弹出 &quot;无法创建该 DNS 服务器的委派……&quot; 对话框中选择 &quot;是&quot; -&gt; 指定数据库文件，日志文件和 SYSVOL 的位置 然后 &quot;下一步&quot; -&gt; 
设置目录还原模式的 Administrator 密码（这个密码将是会在删除域或当您的域出现问题需要还原的时候需要用到的） 然后 &quot;下一步&quot; -&gt; 
 然后 &quot;下一步&quot; -&gt; 
 然后 &quot;完成&quot; 后重启计算机
</code></pre></div></li>
<li><p>新建域管理员用户：</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">打开 &quot;服务器管理器&quot; -&gt; 依次展开 &quot;角色&quot;，&quot;Active Directory域服务&quot;，&quot;Active Directory用户和计算机&quot;，&quot;ad.test.com&quot;

右键单击 &quot;ad.test.com&quot; -&gt; &quot;新建&quot; -&gt; &quot;组织单位&quot; -&gt; 输入名称 &quot;xendesktop&quot; -&gt; &quot;确定&quot;

然后右键单击 &quot;xendesktop&quot;  -&gt; &quot;新建&quot; -&gt; &quot;用户&quot; -&gt; 输入姓名 &quot;admin&quot;，用户登录名 &quot;admin&quot;  然后 &quot;下一步&quot; -&gt; 输入密码 &quot;******&quot;，勾选 &quot;用户不能更改密码&quot; 然后 &quot;下一步&quot; -&gt; &quot;完成&quot;

至此一个普通的域用户就已经创建好了，下面是将一个用户设为域管理员

右键单击 &quot;admin&quot; 用户 -&gt; &quot;添加到组&quot; -&gt; &quot;高级&quot; -&gt; &quot;立即查找&quot; -&gt; 选择 &quot;Domain Admins&quot; -&gt; &quot;确定&quot;  -&gt; &quot;确定&quot;

至此成功将一个域普通用户提升为域管理员用户
</code></pre></div></li>
</ol>

<h3>安装 Xendesktop</h3>

<ol>
<li><p>安装 Xendesktop 时不能同 AD 使用同一模版，安装前先陪好静态 IP，修改主机名，关闭防火墙，配置好服务器时间，把安装 Xendesktop 的计算机加入到 AD 域中，然后重启。</p></li>
<li><p>用 域管理员 帐号登录计算机，然后安装：</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">运行 &quot;Xendesktop.iso&quot; -&gt; 
选择 &quot;安装 XenDesktop&quot; -&gt; 
勾选 &quot;我接受这些条款和条件&quot; 然后 &quot;下一步&quot; -&gt; 
默认全选  然后 &quot;下一步&quot; -&gt; 
勾选 &quot;启用这些端口&quot;  然后 &quot;下一步&quot; -&gt; 
选择 &quot;安装&quot;，等待大约十多分钟就装好了。
</code></pre></div></li>
</ol>

<h3>安装 DHCP</h3>

<ol>
<li><p>DHCP 服务器可以和 AD 安装在同一台主机上</p></li>
<li><p>安装步骤：</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">打开 &quot;服务器管理器&quot; -&gt; &quot;角色&quot; -&gt; 单击 &quot;添加角色&quot; -&gt; 
在打开的窗口中勾选 &quot;DHCP 服务器&quot; -&gt; &quot;下一步&quot; -&gt; 直接 &quot;下一步&quot; -&gt; 

在指定 IPv4 DNS 服务器配置中：
    父域： ad.test.com
    首选 DNS：本机网络中有效的真是 IP 地址（因为我们在安装 AD 时，已经在本地安装了 DNS 服务），当然你也可以使用其它的 DNS 服务器， 然后 &quot;下一步&quot; -&gt; 
选择 &quot;在此网路上应用程序不需要 WINS&quot;， 然后 &quot;下一步&quot; -&gt; 

在添加或编辑 DHCP 作用域中，点击添加：
    作用域名称：        Xendesktop-DHCP
    起始 IP 地址，结束 IP 地址中填入可用的 IP 地址范围，（注意：DNS 服务器 地址 必须包含在此范围内）
    子网类型： 有线(租用持续时间将为8天)
    勾选 &quot;激活此作用域&quot;
    默认网关和子网掩码都按实际填写

选择 &quot;对此服务器启动 IPv6 无状态模式&quot;， 然后 &quot;下一步&quot; -&gt; &quot;确定&quot; -&gt; &quot;完成&quot;
</code></pre></div></li>
</ol>

<h3>制作模板镜像</h3>

<ol>
<li><p>安装 Xendesktop Agent 的系统必须是 Windows Xp  或者 Windows 7。 安装的好系统后将计算机加入域中，并通过 DHCP 获取 IP 地址，然后重启。</p></li>
<li><p>用 域管理员 帐号登录计算机，然后安装：</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">运行 &quot;Xendesktop.iso&quot; -&gt; 
选择 &quot;安装虚拟桌面代理&quot; -&gt; 
选择 &quot;高级安装&quot; -&gt; 
勾选 &quot;我接受这些条款和条件&quot; 然后 &quot;下一步&quot; -&gt; 
选择 &quot;虚拟桌面代理&quot; 然后 &quot;下一步&quot; -&gt; 
去掉已选的 &quot;Citrix Receiver&quot;  然后 &quot;下一步&quot; -&gt; 
勾选 &quot;否，不立即启动 Personal vDisk&quot;  然后 &quot;下一步&quot; -&gt; 
选择 &quot;手动输入控制器位置&quot;（控制器为：安装 Xendesktop 服务器端的主机名.ad.test.com ） 然后 &quot;下一步&quot; -&gt; 
勾选所有  然后 &quot;下一步&quot; -&gt; 
选择 &quot;安装&quot;，装好后重启计算机。
</code></pre></div></li>
</ol>

  </div>

  <!-- 底部导航条 -->
  <div class="nav nav-fix-bottom"  id="nav-fix-bottom">
      <div class="navbar-panel">
          <div id="page-nav-list" class="catalog pull-left"></div>
      </div>
  </div>

  <link rel="stylesheet" type="text/css" href="/assets/css/monokai.min.css">
  <script type="text/javascript" src="/assets/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

<!-- duoshuo div -->
<div class="well">
  <div class="ds-thread"></div>
</div>

<!-- Duoshuo Comment BEGIN -->
<script type="text/javascript">
  var duoshuoQuery = {short_name:"tang-blog"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- Duoshuo Comment END -->
<!-- Baidu Button BEGIN -->
<script type="text/javascript" id="bdshare_js" data="type=slide&amp;img=5&amp;mini=1&amp;pos=left&amp;uid=6635097" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
</script>
<!-- Baidu Button END -->
    <div class="footer">
      &copy; 2013 唐久军 - Crafted with 
        <a href="http://jekyllrb.com/"><strong>Jekyll</strong></a>, Hosted on 
        <strong><a href="https://github.com/">GitHub</a></strong>
        | 转载请遵守 <a href="http://creativecommons.org/licenses/by-sa/3.0/cn/">CC BY-SA 3.0</a> 协议
        <span class="pull-right">
          <strong>
            <a href="https://github.com/tangjiujun">Fork me on GitHub </a>
          </strong>
        </span>
    </div>
  </body>
</html>
